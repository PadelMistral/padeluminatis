<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0A2342">
    <title>Mi Perfil - Padeluminatis</title>
    <link rel="icon" type="image/x-icon" href="./imagenes/Logojafs.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./css/header.css">
    <link rel="stylesheet" href="./css/perfil.css">
    <link rel="stylesheet" href="css/modal-busqueda.css">
    <style>
        /* Estilos para el overlay del modal */
        #modal-busqueda-usuarios,
        #modal-perfil-otro {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            background: rgba(10, 10, 20, 0.85) !important;
            backdrop-filter: blur(8px);
            z-index: 9998 !important;
            display: none;
            align-items: center !important;
            justify-content: center !important;
            padding: 20px !important;
            box-sizing: border-box !important;
        }

        /* Estilos para el contenido del modal */
        #modal-busqueda-usuarios .busqueda-modal-content,
        #modal-perfil-otro .perfil-otro-modal-content {
            width: 100% !important;
            height: 100% !important;
            max-width: 1400px !important;
            max-height: 90vh !important;
            overflow-y: auto !important;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 70%, #0f3460 100%) !important;
            border-radius: 20px !important;
            padding: 40px !important;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            position: relative !important;
            transform: none !important;
            top: auto !important;
            left: auto !important;
            margin: 0 !important;
        }
    </style>
</head>

<body class="app-body">
    <header class="app-header">
        <div class="header-content">
            <img src="./imagenes/Logojafs.png" alt="Logo" class="app-logo">
            <h1 class="app-title">Mi Perfil - Padeluminatis</h1>
            <button class="menu-toggle" aria-label="Menú">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <nav class="app-nav">
          <a href="./home.html" class="nav-item"><i class="fas fa-home"></i><span>Inicio</span></a>
          <a href="./eventos.html" class="nav-item"><i class="fas fa-calendar-check"></i><span>Eventos</span></a>
          <a href="./calendario.html" class="nav-item"><i class="fas fa-calendar-alt"></i><span>Calendario</span></a>
          <a href="./clasificacion.html" class="nav-item"><i class="fas fa-trophy"></i><span>Clasificación</span></a>
          <a href="./normas.html" class="nav-item"><i class="fas fa-gavel"></i><span>Normas</span></a>
          <a href="./chat.html" class="nav-item"><i class="fas fa-comments"></i><span>Chat</span></a>
          <a href="./simulador-visual-real.html" class="nav-item"><i class="fas fa-list-ol"></i><span>Ranking</span></a>
          <a href="./admin.html" class="nav-item nav-admin" style="display:none"><i class="fas fa-user-shield"></i><span>Admin</span></a>
          <a href="./perfil.html" class="nav-item active"><i class="fas fa-user"></i><span>Perfil</span></a>
          <a href="./notificaciones.html" class="nav-item"><i class="fas fa-bell"></i><span>Notificaciones</span></a>
          <a href="#" class="nav-item nav-logout"><i class="fas fa-sign-out-alt"></i><span>Cerrar sesión</span></a>
        </nav>
    </header>
    <main class="app-main">
        <section class="profile-section">
            <div class="profile-background">
                <div class="profile-glow"></div>
                <div class="profile-particles"></div>
            </div>
            
            <div class="profile-container">
                <!-- Foto de Perfil Centrada -->
                <div class="profile-image-container">
                    <div class="profile-image-frame">
                        <img id="profile-pic" src="https://ui-avatars.com/api/?name=Usuario&background=00a884&color=fff" alt="Foto de perfil">
                        <div class="edit-icon">
                            <i class="fas fa-camera"></i>
                        </div>
                        <div class="edit-overlay" id="edit-profile-pic">
                            <i class="fas fa-camera"></i>
                            <span>Cambiar foto</span>
                        </div>
                    </div>
                </div>

                <!-- Información del Usuario -->
                <div class="profile-info-container">
                    <div class="user-presentation">
                        <h1 id="user-name" class="user-name">Cargando...</h1>
                        <div class="user-level-container">
                            <div class="level-badge">
                                <span id="user-level">1.5</span>
                            </div>
                            <div class="level-progress-container">
                                <div class="level-progress-bar">
                                    <div id="level-progress" class="level-progress-fill"></div>
                                </div>
                                <span class="level-text">Progreso: <span id="level-percentage">0</span>%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Estadísticas Principales -->
                    <div class="profile-stats-grid">
                        <div class="stat-card-main">
                            <div class="stat-icon">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-value" id="family-points">500</span>
                                <span class="stat-label">Family Points</span>
                            </div>
                        </div>
                        
                        <div class="stat-card-main">
                            <div class="stat-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-value" id="total-points">0</span>
                                <span class="stat-label">Puntos Ranking</span>
                            </div>
                        </div>
                        
                        <div class="stat-card-main">
                            <div class="stat-icon">
                                <i class="fas fa-medal"></i>
                            </div>
                            <div class="stat-content" id="logros-stat-content" style="cursor: pointer;" onclick="window.location.href='./logros.html'">
                                <span class="stat-value" id="achievements-unlocked">0</span>
                                <span class="stat-label">Logros</span>
                            </div>
                        </div>
                        
                        <div class="stat-card-main">
                            <div class="stat-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div class="stat-content">
                                    <span class="stat-value" id="retos-jugados">0</span>
                                    <span class="stat-label">Retos jugados</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Secciones de Competición -->
            <div class="competition-sections">
                <!-- Liga Actual -->
                <div class="competition-card league-card">
                    <div class="competition-header">
                        <i class="fas fa-trophy"></i>
                        <h3>Liga Actual</h3>
                    </div>
                    <div class="competition-content">
                        <div class="competition-stat">
                            <span class="stat-label">Posición</span>
                            <span class="stat-value" id="league-position">-</span>
                        </div>
                        <div class="competition-stat">
                            <span class="stat-label">Puntos</span>
                            <span class="stat-value" id="league-points">0/0</span>
                        </div>
                        <div class="competition-stat">
                            <span class="stat-label">Equipos</span>
                            <span class="stat-value" id="league-teams">0</span>
                        </div>
                        <div class="competition-stat">
                            <span class="stat-label">Líder</span>
                            <span class="stat-value" id="league-leader">N/A</span>
                        </div>
                        <div class="competition-stat">
                            <span class="stat-label">Último</span>
                            <span class="stat-value" id="league-last">N/A</span>
                        </div>
                        <div class="competition-progress">
                            <span class="progress-label">Acabar partidos</span>
                            <div class="progress-bar-competition">
                                <div id="league-finished-bar" class="progress-fill-competition"></div>
                            </div>
                            <span class="progress-text" id="league-finished-percent">0%</span>
                            <span class="progress-text" id="league-finished-left-text">0 partidos restantes</span>
                        </div>
                        <div class="competition-progress">
                            <span class="progress-label">Final de Liga</span>
                            <div class="progress-bar-competition">
                                <div id="league-progress" class="progress-fill-competition"></div>
                            </div>
                            <span class="progress-text" id="league-matches-left-text">0 partidos restantes</span>
                        </div>
                    </div>
                </div>

                <!-- Torneos Actuales -->
                <div class="competition-card tournament-card">
                    <div class="competition-header">
                        <i class="fas fa-star"></i>
                        <h3>Torneos Actuales</h3>
                    </div>
                    <div class="competition-content">
                        <div id="tournaments-list" class="tournaments-list">
                            <div class="no-tournaments">
                                <i class="fas fa-info-circle"></i>
                                <span>No estás registrado en ningún torneo</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Amistosos -->
                <div class="competition-card friendly-card">
                    <div class="competition-header">
                        <i class="fas fa-handshake"></i>
                        <h3>Amistosos</h3>
                    </div>
                    <div class="competition-content">
                        <div class="competition-stat">
                            <span class="stat-label">Total Jugados</span>
                            <span class="stat-value" id="friendly-total">0</span>
                        </div>
                        <div class="competition-stat">
                            <span class="stat-label">Victorias</span>
                            <span class="stat-value" id="friendly-wins">0</span>
                        </div>
                        <div class="competition-stat">
                            <span class="stat-label">Derrotas</span>
                            <span class="stat-value" id="friendly-losses">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Acciones del Perfil -->
            <div class="profile-actions">
                <button class="action-button compare-profile" id="compare-profile">
                    <i class="fas fa-search"></i>
                    <span>Buscar Perfil Jugador</span>
                </button>
                <button class="action-button challenge-friend" id="challenge-friend">
                    <i class="fas fa-sword"></i>
                    <span>Retar a un Amigo</span>
                </button>
            </div>
        </section>

        <!-- Compañero Actual -->
        <section class="partner-section scroll-reveal">
            <div class="partner-card compact-card">
                <span class="mini-title">Compañero</span>
                <h3>Compañero Actual</h3>
                <div class="player-info">
                    <img id="partner-pic" src="https://ui-avatars.com/api/?name=Compañero&background=00a884&color=fff" alt="Compañero">
                    <div class="player-details">
                        <h4 id="partner-name">Sin compañero</h4>
                        <div class="player-stats">
                            <div class="stat">
                                <i class="fas fa-gamepad"></i>
                                <span id="partner-matches">0</span> partidos
                            </div>
                            <div class="stat">
                                <i class="fas fa-trophy"></i>
                                <span id="partner-wins">0</span> victorias
                            </div>
                            <div class="stat">
                                <i class="fas fa-percentage"></i>
                                <span id="partner-win-rate">0%</span> win rate
                            </div>
                        </div>
                    </div>
                </div>
                <div class="partner-actions">
                    <button id="change-partner" class="action-button change-partner"><i class="fas fa-exchange-alt"></i>Cambiar compañero</button>
                </div>
            </div>
        </section>

        <!-- Estadísticas Generales -->
        <section class="stats-grid compact-stats">
            <div class="stat-card scroll-reveal compact-card">
                <span class="mini-title">General</span>
                <h3>Estadísticas Generales</h3>
                <div class="stats-grid-3">
                    <div class="stat-item-compact">
                        <i class="fas fa-gamepad"></i>
                        <span class="stat-value" id="total-matches">0</span>
                        <span class="stat-label">Partidos</span>
                    </div>
                    <div class="stat-item-compact">
                        <i class="fas fa-trophy"></i>
                        <span class="stat-value" id="total-wins">0</span>
                        <span class="stat-label">Victorias</span>
                    </div>
                    <div class="stat-item-compact">
                        <i class="fas fa-times-circle"></i>
                        <span class="stat-value" id="total-losses">0</span>
                        <span class="stat-label">Derrotas</span>
                    </div>
                    <div class="stat-item-compact">
                        <i class="fas fa-percentage"></i>
                        <span class="stat-value" id="win-rate">0%</span>
                        <span class="stat-label">Win Rate</span>
                    </div>
                    <div class="stat-item-compact">
                        <i class="fas fa-fire"></i>
                        <span class="stat-value" id="current-streak">0</span>
                        <span class="stat-label">Racha Actual</span>
                    </div>
                    <div class="stat-item-compact">
                        <i class="fas fa-crown"></i>
                        <span class="stat-value" id="best-streak">0</span>
                        <span class="stat-label">Mejor Racha</span>
                    </div>
                </div>
            </div>

            <!-- Victorias por Tipo -->
            <div class="stat-card scroll-reveal compact-card">
                <span class="mini-title">Tipos</span>
                <h3>Victorias por Tipo</h3>
                <div class="stats-grid-3">
                    <div class="stat-item-compact">
                        <i class="fas fa-trophy"></i>
                        <span class="stat-value" id="league-wins">0</span>
                        <span class="stat-label">Ligas</span>
                    </div>
                    <div class="stat-item-compact">
                        <i class="fas fa-handshake"></i>
                        <span class="stat-value" id="friendly-wins">0</span>
                        <span class="stat-label">Amistosos</span>
                    </div>
                    <div class="stat-item-compact">
                        <i class="fas fa-star"></i>
                        <span class="stat-value" id="event-wins">0</span>
                        <span class="stat-label">Eventos</span>
                    </div>
                    <div class="stat-item-compact">
                        <i class="fas fa-bolt"></i>
                        <span class="stat-value" id="challenge-wins">0</span>
                        <span class="stat-label">Retos</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Mi Pala -->
        <section class="paddle-section scroll-reveal" style="display: flex; justify-content: center;">
            <div class="paddle-card">
                <div class="paddle-header">
                    <h3>Mi Pala</h3>
                    <select id="paddle-select" class="paddle-select">
                        <option value="">Seleccionar Pala</option>
                        <!-- Las palas se cargarán dinámicamente -->
                    </select>
                </div>
                <div class="paddle-content">
                    <div class="paddle-image">
                        <img id="paddle-pic" src="imagenes/5c0e4dc8-3bc6-4692-9e73-47d471dcd846.webp" alt="Pala">
                    </div>
                    <div class="paddle-info">
                        <h4 id="paddle-name">Sin pala seleccionada</h4>
                        <div class="paddle-stats">
                            <div class="stat">
                                <span>Potencia</span>
                                <div class="progress-bar">
                                    <div id="power-stat" class="progress" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="stat">
                                <span>Control</span>
                                <div class="progress-bar">
                                    <div id="control-stat" class="progress" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="stat">
                                <span>Punto Dulce</span>
                                <div class="progress-bar">
                                    <div id="sweet-spot-stat" class="progress" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="stat">
                                <span>Ligereza</span>
                                <div class="progress-bar">
                                    <div id="lightness-stat" class="progress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="paddle-actions">
                    <button class="action-button" id="compare-paddle">
                        <i class="fas fa-balance-scale"></i> Comparar Pala
                    </button>
                </div>
            </div>
        </section>

        <!-- Top Jugadores -->
        <section class="rivals-section compact-stats">
            <div class="rivals-card scroll-reveal compact-card">
                <span class="mini-title">Rivales</span>
                <h3>Top Jugadores</h3>
                
                <!-- Rival Más Fácil -->
                <div class="rival-item">
                    <h4>Mi Rival Más Fácil</h4>
                    <div class="player-info">
                        <img id="top-wins-pic" src="https://ui-avatars.com/api/?name=TopVictorias&background=4CAF50&color=fff" alt="Rival Fácil">
                        <div class="player-details">
                            <h5 id="top-wins-name">Sin datos</h5>
                            <div class="player-stats">
                                <div class="stat">
                                    <i class="fas fa-trophy"></i>
                                    <span id="top-wins-count">0</span> victorias
                                </div>
                                <div class="stat">
                                    <i class="fas fa-times-circle"></i>
                                    <span id="top-wins-losses">0</span> derrotas
                                </div>
                            </div>
                            <div id="top-wins-details" class="rival-details">
                                <!-- Detalles del mejor rival se cargarán dinámicamente -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Rival Más Difícil -->
                <div class="rival-item">
                    <h4>Mi Rival Más Difícil</h4>
                    <div class="player-info">
                        <img id="worst-rival-pic" src="https://ui-avatars.com/api/?name=PeorRival&background=f44336&color=fff" alt="Rival Difícil">
                        <div class="player-details">
                            <h5 id="worst-rival-name">Sin datos</h5>
                            <div class="player-stats">
                                <div class="stat">
                                    <i class="fas fa-times-circle"></i>
                                    <span id="worst-rival-losses">0</span> derrotas
                                </div>
                                <div class="stat">
                                    <i class="fas fa-trophy"></i>
                                    <span id="worst-rival-wins">0</span> victorias
                                </div>
                            </div>
                            <div id="worst-rival-details" class="rival-details">
                                <!-- Detalles del peor rival se cargarán dinámicamente -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Botón para abrir historial -->
        <section class="history-section scroll-reveal">
            <button class="history-button" id="open-history-modal">
                <i class="fas fa-history"></i>
                <span>Ver Historial de Partidos</span>
            </button>
        </section>

        <!-- Modal de Historial de Partidos -->
        <div class="modal-historial" id="modal-historial" style="display:none;">
            <div class="modal-historial-content">
                <button class="close-modal-historial" data-modal="modal-historial">
                    <i class="fas fa-times"></i>
                </button>
                <h3>Historial de Partidos</h3>
                <div class="historial-filtros">
                    <button class="action-button active" data-filter="all">Todos</button>
                    <button class="action-button" data-filter="wins">Victorias</button>
                    <button class="action-button" data-filter="losses">Derrotas</button>
                </div>
                <div class="historial-tipo-filtros">
                    <button class="action-button" data-tipo="all">Todos los tipos</button>
                    <button class="action-button" data-tipo="liga">Liga</button>
                    <button class="action-button" data-tipo="amistoso">Amistoso</button>
                    <button class="action-button" data-tipo="evento">Eventos</button>
                </div>
                <div id="historial-partidos" class="historial-list">
                    <!-- Los partidos se cargarán dinámicamente -->
                </div>
            </div>
        </div>

        <!-- Modal para cambiar compañero -->
        <div id="modal-cambiar-companero" class="modal-lista" style="display:none;">
          <div class="modal-lista-content">
            <span class="close-modal-lista" id="close-modal-cambiar-companero">&times;</span>
            <h3>Cambiar compañero</h3>
            <p>¿Qué opción deseas?</p>
            <button id="option-sin-companero" class="action-button">Quedarme sin compañero</button>
            <div style="margin: 10px 0;">
              <label for="select-nuevo-companero">Seleccionar nuevo compañero:</label>
              <select id="select-nuevo-companero" class="action-button" style="width:100%;margin-top:5px;"></select>
              <button id="option-cambiar-companero" class="action-button" style="margin-top:8px;">Solicitar cambio</button>
            </div>
            <button id="option-cancelar-cambio" class="action-button" style="background:#b91c1c;margin-top:10px;">Cancelar</button>
            </div>
        </div>

        <!-- Modal de Búsqueda de Usuarios -->
        <div id="modal-busqueda-usuarios" class="modal-busqueda">
            <div class="busqueda-modal-content">
                <div class="busqueda-header">
                    <h3><i class="fas fa-search"></i> Buscar Perfil Jugador</h3>
                    <button id="close-busqueda-modal" class="close-busqueda-modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="busqueda-filtros">
                    <div class="busqueda-input-container">
                        <input type="text" id="busqueda-input" placeholder="Buscar por nombre o email..." class="busqueda-input">
                        <button id="buscar-btn" class="buscar-btn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                
                <div class="usuarios-container">
                    <div id="usuarios-lista" class="usuarios-lista">
                        <!-- Los usuarios se cargarán dinámicamente -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script type="module" src="./js/usuario-session.js"></script>
    <script type="module" src="./js/perfil.js"></script>
    <script src="./js/menu-hamburguesa.js"></script>
    <script type="module" src="./js/enlaceAdmin.js"></script>

    <!-- Input oculto para cambiar foto de perfil -->
    <input type="file" id="profile-pic-input" accept="image/*" style="display:none;" />
</body>
</html>
